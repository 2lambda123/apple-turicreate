

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>turicreate.SGraph.triple_apply &mdash; Turi Create API 5.4 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
    <link rel="top" title="Turi Create API 5.4 documentation" href="../index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> Turi Create API</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../turicreate.data_structures.html">Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../turicreate.data_structures.html#id1">Data Structures</a></li>
<li class="toctree-l2"><a class="reference internal" href="../turicreate.data_structures.html#data-types">Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../turicreate.data_structures.html#utilities">Utilities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../turicreate.toolkits.html">Modelling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../turicreate.toolkits.html#applications">Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../turicreate.toolkits.html#essentials">Essentials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../turicreate.toolkits.html#utilities">Utilities</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../turicreate.visualization.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../turicreate.utils.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../turicreate.utils.html#logging">logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../turicreate.utils.html#runtime">runtime</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
      
        <span class="powered-by">
          <a id="footer-logo" href="https://github.com/apple/turicreate"><img src="../_static/tc_logo_white.png"/></a>
        </span>
      
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Turi Create API</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>turicreate.SGraph.triple_apply</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="turicreate-sgraph-triple-apply">
<h1>turicreate.SGraph.triple_apply<a class="headerlink" href="#turicreate-sgraph-triple-apply" title="Permalink to this headline">¶</a></h1>
<dl class="method">
<dt id="turicreate.SGraph.triple_apply">
<code class="descclassname">SGraph.</code><code class="descname">triple_apply</code><span class="sig-paren">(</span><em>triple_apply_fn</em>, <em>mutated_fields</em>, <em>input_fields=None</em><span class="sig-paren">)</span><a class="headerlink" href="#turicreate.SGraph.triple_apply" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply a transform function to each edge and its associated source and
target vertices in parallel. Each edge is visited once and in parallel.
Modification to vertex data is protected by lock. The effect on the
returned SGraph is equivalent to the following pseudocode:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">PARALLEL</span> <span class="n">FOR</span> <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="n">AS</span> <span class="n">triple</span> <span class="ow">in</span> <span class="n">G</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">LOCK</span> <span class="p">(</span><span class="n">triple</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">triple</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="gp">... </span>    <span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="o">=</span> <span class="n">triple_apply_fn</span><span class="p">(</span><span class="n">triple</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">UNLOCK</span> <span class="p">(</span><span class="n">triple</span><span class="o">.</span><span class="n">source</span><span class="p">,</span> <span class="n">triple</span><span class="o">.</span><span class="n">target</span><span class="p">)</span>
<span class="gp">... </span><span class="n">END</span> <span class="n">PARALLEL</span> <span class="n">FOR</span>
</pre></div>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first docutils">
<dt><strong>triple_apply_fn</strong> <span class="classifier-delimiter">:</span> <span class="classifier">function</span></dt>
<dd><p class="first last">The function to apply to each triple of (source_vertex, edge,
target_vertex). This function must take as input a tuple of
(source_data, edge_data, target_data) and return a tuple of
(new_source_data, new_edge_data, new_target_data). All variables in
the both tuples must be of dict type.
This can also be a toolkit extension function which is compiled
as a native shared library using SDK.</p>
</dd>
<dt><strong>mutated_fields</strong> <span class="classifier-delimiter">:</span> <span class="classifier">list[str] | str</span></dt>
<dd><p class="first last">Fields that <code class="docutils literal"><span class="pre">triple_apply_fn</span></code> will mutate. Note: columns that are
actually mutated by the triple apply function but not specified in
<code class="docutils literal"><span class="pre">mutated_fields</span></code> will have undetermined effects.</p>
</dd>
<dt><strong>input_fields</strong> <span class="classifier-delimiter">:</span> <span class="classifier">list[str] | str, optional</span></dt>
<dd><p class="first last">Fields that <code class="docutils literal"><span class="pre">triple_apply_fn</span></code> will have access to.
The default is <code class="docutils literal"><span class="pre">None</span></code>, which grants access to all fields.
<code class="docutils literal"><span class="pre">mutated_fields</span></code> will always be included in <code class="docutils literal"><span class="pre">input_fields</span></code>.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>out</strong> <span class="classifier-delimiter">:</span> <span class="classifier">SGraph</span></dt>
<dd><p class="first last">A new SGraph with updated vertex and edge data. Only fields
specified in the <code class="docutils literal"><span class="pre">mutated_fields</span></code> parameter are updated.</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
<p class="rubric">Notes</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">triple_apply</span></code> does not currently support creating new fields in the
lambda function.</li>
</ul>
<p class="rubric">Examples</p>
<p>Import turicreate and set up the graph.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">edges</span> <span class="o">=</span> <span class="n">turicreate</span><span class="o">.</span><span class="n">SFrame</span><span class="p">({</span><span class="s1">&#39;source&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span> <span class="s1">&#39;dest&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">turicreate</span><span class="o">.</span><span class="n">SGraph</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">src_field</span><span class="o">=</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="n">dst_field</span><span class="o">=</span><span class="s1">&#39;dest&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="s1">&#39;degree&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
<p>Define the function to apply to each (source_node, edge, target_node)
triple.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">degree_count_fn</span> <span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
<span class="go">        src[&#39;degree&#39;] += 1</span>
<span class="go">        dst[&#39;degree&#39;] += 1</span>
<span class="go">        return (src, edge, dst)</span>
</pre></div>
</div>
<p>Apply the function to the SGraph.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">triple_apply</span><span class="p">(</span><span class="n">degree_count_fn</span><span class="p">,</span> <span class="n">mutated_fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;degree&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Using native toolkit extension function:</p>
<div class="highlight-c++"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;turicreate/sdk/toolkit_function_macros.hpp&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">turi</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">variant_type</span><span class="o">&gt;</span> <span class="n">connected_components_parameterized</span><span class="p">(</span>
  <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">flexible_type</span><span class="o">&gt;&amp;</span> <span class="n">src</span><span class="p">,</span>
  <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">flexible_type</span><span class="o">&gt;&amp;</span> <span class="n">edge</span><span class="p">,</span>
  <span class="n">std</span><span class="o">::</span><span class="n">map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">flexible_type</span><span class="o">&gt;&amp;</span> <span class="n">dst</span><span class="p">,</span>
  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">column</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dst</span><span class="p">[</span><span class="n">column</span><span class="p">])</span> <span class="n">dst</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[</span><span class="n">column</span><span class="p">];</span>
    <span class="k">else</span> <span class="n">src</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">dst</span><span class="p">[</span><span class="n">column</span><span class="p">];</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">to_variant</span><span class="p">(</span><span class="n">src</span><span class="p">),</span> <span class="n">to_variant</span><span class="p">(</span><span class="n">edge</span><span class="p">),</span> <span class="n">to_variant</span><span class="p">(</span><span class="n">dst</span><span class="p">)};</span>
<span class="p">}</span>

<span class="n">BEGIN_FUNCTION_REGISTRATION</span>
<span class="n">REGISTER_FUNCTION</span><span class="p">(</span><span class="n">connected_components_parameterized</span><span class="p">,</span> <span class="s">&quot;src&quot;</span><span class="p">,</span> <span class="s">&quot;edge&quot;</span><span class="p">,</span> <span class="s">&quot;dst&quot;</span><span class="p">,</span> <span class="s">&quot;column&quot;</span><span class="p">);</span>
<span class="n">END_FUNCTION_REGISTRATION</span>
</pre></div>
</div>
<p>compiled into example.so</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">example</span> <span class="kn">import</span> <span class="n">connected_components_parameterized</span> <span class="k">as</span> <span class="n">cc</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">e</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">SFrame</span><span class="p">({</span><span class="s1">&#39;__src_id&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="s1">&#39;__dst_id&#39;</span><span class="p">:[</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">SGraph</span><span class="p">()</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="s1">&#39;cid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="s1">&#39;__id&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">triple_apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">src</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">dst</span><span class="p">:</span> <span class="n">cc</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">edge</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="s1">&#39;cid&#39;</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;cid&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;cid&#39;</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="s1">&#39;cid&#39;</span><span class="p">]</span>
<span class="go">dtype: int</span>
<span class="go">Rows: 5</span>
<span class="go">[4, 1, 1, 1, 4]</span>
</pre></div>
</div>
</dd></dl>

</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
      Last updated on Mar 27, 2019.
    </p>
  </div>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.4',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false
        };
    </script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>