<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Turi Create: turi::fileio::file_handle_pool Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Turi Create
   &#160;<span id="projectnumber">4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classturi_1_1fileio_1_1file__handle__pool.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="classturi_1_1fileio_1_1file__handle__pool-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">turi::fileio::file_handle_pool Class Reference<div class="ingroups"><a class="el" href="group__fileio.html">File IO Library</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;<a class="el" href="file__handle__pool_8hpp_source.html">core/storage/fileio/file_handle_pool.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a4b16a9b98ecf60b0890f17f95fb0d093"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="structturi_1_1fileio_1_1file__ownership__handle.html">file_ownership_handle</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classturi_1_1fileio_1_1file__handle__pool.html#a4b16a9b98ecf60b0890f17f95fb0d093">register_file</a> (const std::string &amp;file_name)</td></tr>
<tr class="separator:a4b16a9b98ecf60b0890f17f95fb0d093"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2517105eefe7afc74f688cb58a763f1d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classturi_1_1fileio_1_1file__handle__pool.html#a2517105eefe7afc74f688cb58a763f1d">mark_file_for_delete</a> (std::string file_name)</td></tr>
<tr class="separator:a2517105eefe7afc74f688cb58a763f1d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08fe73c366947dfc06d18187a91c291a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classturi_1_1fileio_1_1file__handle__pool.html#a08fe73c366947dfc06d18187a91c291a">unmark_file_for_delete</a> (std::string file_name)</td></tr>
<tr class="separator:a08fe73c366947dfc06d18187a91c291a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ae146526f838dde1c12e2c137fefe386e"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classturi_1_1fileio_1_1file__handle__pool.html">file_handle_pool</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classturi_1_1fileio_1_1file__handle__pool.html#ae146526f838dde1c12e2c137fefe386e">get_instance</a> ()</td></tr>
<tr class="separator:ae146526f838dde1c12e2c137fefe386e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A global file lifespan manager that manages life time for non temporary files that are currently in use by any SArray(including the array index file and the segment files).</p>
<p>Permanent files used by SArray can be removed when user saves a SArray to a directory where there is already a SArray saved there. In case there is some SArray actively referencing the files in the directory, we will delay deletion of those files until nobody is referencing those files. new files will be created under the directory to save the new SArray and the directory index will correctly point to the new files.</p>
<p>A file_handle object is created for each file that is in use by SArray. All SArrays referencing those files keep a shared pointer to the file handle object. On reading from a directory, SAray registers the files with global <a class="el" href="classturi_1_1fileio_1_1file__handle__pool.html">file_handle_pool</a>, When SArray is out of scope, the corresponding ref to the file_handle is removed. Once all ref of a given file_handle goes away, the files may or may not be deleted depend on whether or not the files are overwritten.</p>
<p>The pool itself keeps a weak pointer to the file_handle object so the files can be deleted when all SArrays referencing the file are gone. </p>

<p class="definition">Definition at line <a class="el" href="file__handle__pool_8hpp_source.html#l00038">38</a> of file <a class="el" href="file__handle__pool_8hpp_source.html">file_handle_pool.hpp</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="ae146526f838dde1c12e2c137fefe386e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae146526f838dde1c12e2c137fefe386e">&#9670;&nbsp;</a></span>get_instance()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classturi_1_1fileio_1_1file__handle__pool.html">file_handle_pool</a>&amp; turi::fileio::file_handle_pool::get_instance </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>Singleton retriever </p>

</div>
</div>
<a id="a2517105eefe7afc74f688cb58a763f1d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2517105eefe7afc74f688cb58a763f1d">&#9670;&nbsp;</a></span>mark_file_for_delete()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool turi::fileio::file_handle_pool::mark_file_for_delete </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>file_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Try to mark the file for deletion, returns success if the mark is done successfuly, other wise, the global file pool doesn't know about the file, caller is responsible for deleting the files The marked files will be deleted when all users are out of scope</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_name</td><td>The name of the file to be marked for deletion </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4b16a9b98ecf60b0890f17f95fb0d093"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b16a9b98ecf60b0890f17f95fb0d093">&#9670;&nbsp;</a></span>register_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="structturi_1_1fileio_1_1file__ownership__handle.html">file_ownership_handle</a>&gt; turi::fileio::file_handle_pool::register_file </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>file_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Register with file pool that a file is in use. Returns a <a class="el" href="structturi_1_1fileio_1_1file__ownership__handle.html">file_ownership_handle</a> to the caller that can do auto deletion of the file if it goes out of scope.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_name</td><td>The name of the file to be registered</td></tr>
  </table>
  </dd>
</dl>
<p>Returns a shared pointer to the newly created <a class="el" href="structturi_1_1fileio_1_1file__ownership__handle.html">file_ownership_handle</a> </p>

</div>
</div>
<a id="a08fe73c366947dfc06d18187a91c291a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a08fe73c366947dfc06d18187a91c291a">&#9670;&nbsp;</a></span>unmark_file_for_delete()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool turi::fileio::file_handle_pool::unmark_file_for_delete </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>file_name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unmarks a previously marked file for deletion. Returns true if the file was previously marked for deletion. False otherwise. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>core/storage/fileio/<a class="el" href="file__handle__pool_8hpp_source.html">file_handle_pool.hpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceturi.html">turi</a></li><li class="navelem"><b>fileio</b></li><li class="navelem"><a class="el" href="classturi_1_1fileio_1_1file__handle__pool.html">file_handle_pool</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
